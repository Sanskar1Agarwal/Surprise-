<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Happy Birthday ðŸŽ‚</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:radial-gradient(circle at top,#1b1b3a,#0f0f1a);
  color:white;
  text-align:center;
  overflow:hidden;
}

h1{margin-top:25px;font-size:2.5em;}
p{opacity:.85}

/* ===== CAKE ===== */
.cake-area{
  margin-top:40px;
  display:flex;
  justify-content:center;
}

.cake{
  position:relative;
  width:280px;
  height:260px;
}

.plate{
  position:absolute;
  bottom:-20px;
  width:100%;
  height:25px;
  background:#eee;
  border-radius:50%;
  box-shadow:0 10px 25px rgba(0,0,0,.4);
}

.layer{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  border-radius:22px;
  background:linear-gradient(to bottom,#ffb3cc,#ff7fa8);
  box-shadow:inset 0 -8px 0 rgba(0,0,0,.1);
  transition:.6s;
}

.bottom{width:280px;height:120px;bottom:0;}
.top{width:190px;height:80px;bottom:105px;}

.icing{
  position:absolute;
  top:0;
  width:100%;
  height:28px;
  background:#ffe1ec;
  border-radius:22px;
}

.icing::after{
  content:"";
  position:absolute;
  width:100%;
  height:20px;
  bottom:-15px;
  background:
    radial-gradient(circle at 15% 0,#ffe1ec 35%,transparent 36%),
    radial-gradient(circle at 45% 0,#ffe1ec 35%,transparent 36%),
    radial-gradient(circle at 75% 0,#ffe1ec 35%,transparent 36%);
}

/* candles */
.candle{
  position:absolute;
  width:12px;
  height:36px;
  background:linear-gradient(#fff,#ddd);
  top:-36px;
  border-radius:4px;
}

.candle:nth-child(2){left:40%;}
.candle:nth-child(3){left:50%;}
.candle:nth-child(4){left:60%;}

.flame{
  width:10px;
  height:14px;
  background:orange;
  border-radius:50%;
  position:absolute;
  top:-14px;
  left:1px;
  animation:flicker .15s infinite alternate;
}

@keyframes flicker{
  from{transform:scale(1);}
  to{transform:scale(1.3);}
}

/* knife */
#knife{
  position:absolute;
  font-size:42px;
  top:-70px;
  left:50%;
  transform:translateX(-50%);
  display:none;
  transition:.3s;
}

/* slices */
.slice{
  position:absolute;
  width:140px;
  height:120px;
  background:linear-gradient(to bottom,#ffb3cc,#ff7fa8);
  bottom:0;
  left:70px;
  clip-path:polygon(50% 0,100% 100%,0 100%);
  opacity:0;
  transition:.9s ease;
}

/* fireworks */
.firework{
  position:absolute;
  width:6px;
  height:6px;
  border-radius:50%;
  animation:explode 1.2s forwards;
}

@keyframes explode{
  from{transform:scale(1);opacity:1;}
  to{transform:scale(6);opacity:0;}
}
</style>
</head>

<body>

<h1>ðŸŽ‰ Happy Birthday Muskan ðŸŽ‰</h1>
<p id="hint">Blow into the mic ðŸŽ¤ to turn off candles</p>

<div class="cake-area">
  <div class="cake" id="cake">

    <div id="knife">ðŸ”ª</div>

    <div class="layer top" id="topLayer">
      <div class="icing"></div>

      <div class="candle"><div class="flame"></div></div>
      <div class="candle"><div class="flame"></div></div>
      <div class="candle"><div class="flame"></div></div>
    </div>

    <div class="layer bottom" id="bottomLayer">
      <div class="icing"></div>
    </div>

    <div class="slice" id="s1"></div>
    <div class="slice" id="s2"></div>
    <div class="slice" id="s3"></div>
    <div class="slice" id="s4"></div>

    <div class="plate"></div>
  </div>
</div>

<script>
/* ===== MIC CANDLE BLOW ===== */
let candlesOut=false;

navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
  const audioCtx=new AudioContext();
  const mic=audioCtx.createMediaStreamSource(stream);
  const analyser=audioCtx.createAnalyser();
  analyser.fftSize=256;
  mic.connect(analyser);

  const data=new Uint8Array(analyser.frequencyBinCount);

  function detectBlow(){
    analyser.getByteFrequencyData(data);
    let volume=data.reduce((a,b)=>a+b)/data.length;

    if(volume>65 && !candlesOut){
      blowCandles();
      candlesOut=true;
    }
    requestAnimationFrame(detectBlow);
  }
  detectBlow();
}).catch(()=>{
  hint.innerText="Microphone permission required ðŸŽ¤";
});

function blowCandles(){
  document.querySelectorAll(".flame").forEach(f=>f.remove());
  hint.innerText="Cut the cake ðŸŽ‚";
  knife.style.display="block";
}

/* ===== CAKE CUT ===== */
const slices=[
  {el:s1,x:-110,y:25},
  {el:s2,x:110,y:25},
  {el:s3,x:-80,y:-35},
  {el:s4,x:80,y:-35}
];
let cutIndex=0;

cake.onclick=()=>{
  if(!candlesOut || cutIndex>=slices.length) return;

  knife.style.top="30px";
  setTimeout(()=>knife.style.top="-70px",300);

  const s=slices[cutIndex];
  s.el.style.opacity=1;
  s.el.style.transform=`translate(${s.x}px,${s.y}px)`;
  cutIndex++;

  if(cutIndex===slices.length){
    topLayer.style.opacity=0;
    bottomLayer.style.opacity=0;
    fireworks();
  }
};

/* ===== FIREWORKS ===== */
function fireworks(){
  setInterval(()=>{
    const f=document.createElement("div");
    f.className="firework";
    f.style.left=Math.random()*100+"vw";
    f.style.top=Math.random()*60+"vh";
    f.style.background=`hsl(${Math.random()*360},100%,50%)`;
    document.body.appendChild(f);
    setTimeout(()=>f.remove(),1200);
  },220);
}
</script>

</body>
</html>
